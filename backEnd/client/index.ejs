<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title><%= roomId %> 채팅방</title>
  </head>
  <body>

    <input type="text" name="talk" id="talk">
    <button id="sendBtn">서버로 보내기</button>
    <button id="loadBtn">불러오기</button>

    <div id="chats"></div>


    <script src="/socket.io/socket.io.js"></script>
    <script>
      // console.log()
      let time = Date.now()
      console.log(time)

      const roomId = location.href.slice(location.href.lastIndexOf("/") + 1)
      // console.log(roomId)


      const socket = io.connect(location.href, {
        path: '/socket.io'
      }); // chat 네임스페이스


      //보낼 때
      document.getElementById("sendBtn").onclick = () => {
        const talk = document.getElementById("talk");
        socket.emit("chatReply", talk.value);
        talk.value = null;
      };


      document.getElementById("loadBtn").onclick = () => {
        //이전 채팅을 불러오는 함수
        socket.emit("chatLoad", {
          time: time,
          roomId: +roomId
        });
      };


      //받을 때
      socket.on("chat", (data) => {
        document.getElementById("chats").innerHTML += `<div>${data}</div>`;
      });

      socket.on("chatloading", (data) => {

        const divE = document.createElement("div");
        divE.innerText = `${data.user}:${data.chat} , createdAt : ${data.createdAt}`
        document.getElementById("chats").prepend(divE);
        time = --data.createdAt;


      });
    </script>


  </body>
</html>